
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>respo</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="respo" class="md-header__button md-logo" aria-label="respo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.5 11 13 7.5l1.4-1.4 2.1 2.1L20.7 4l1.4 1.4-5.6 5.6M11 7H2v2h9V7m10 6.4L19.6 12 17 14.6 14.4 12 13 13.4l2.6 2.6-2.6 2.6 1.4 1.4 2.6-2.6 2.6 2.6 1.4-1.4-2.6-2.6 2.6-2.6M11 15H2v2h9v-2Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            respo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/rafsaf/respo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rafsaf/respo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="respo" class="md-nav__button md-logo" aria-label="respo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.5 11 13 7.5l1.4-1.4 2.1 2.1L20.7 4l1.4 1.4-5.6 5.6M11 7H2v2h9V7m10 6.4L19.6 12 17 14.6 14.4 12 13 13.4l2.6 2.6-2.6 2.6 1.4 1.4 2.6-2.6 2.6 2.6 1.4-1.4-2.6-2.6 2.6-2.6M11 15H2v2h9v-2Z"/></svg>

    </a>
    respo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rafsaf/respo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    rafsaf/respo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Overview
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-in-fastapi" class="md-nav__link">
    Usage in FastAPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#declaring-yml-file-with-permissions-roles" class="md-nav__link">
    Declaring YML file with permissions, roles.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-yml-file-to-readonly-pickle-using-respo-cli-interface" class="md-nav__link">
    Parsing YML file to readonly pickle using respo CLI interface.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-in-fastapi-and-sqlalchemy" class="md-nav__link">
    Usage in FastAPI and SQLAlchemy.
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="install/" class="md-nav__link">
        Install
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="usage/declaring_roles_and_permissions/" class="md-nav__link">
        Declaring roles and permissions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="usage/respo_create_cli/" class="md-nav__link">
        Respo create CLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="usage/get_respo_model/" class="md-nav__link">
        Get respo model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="usage/user_have_permission/" class="md-nav__link">
        FastAPI + SQLAlchemy dependency user_have_permission
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="usage/environment_variables/" class="md-nav__link">
        Configuration - environment variables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/core/" class="md-nav__link">
        Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/cli/" class="md-nav__link">
        Cli
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/client/" class="md-nav__link">
        Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/fields.django/" class="md-nav__link">
        Fields.django
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/fields.sqlalchemy/" class="md-nav__link">
        Fields.sqlalchemy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-in-fastapi" class="md-nav__link">
    Usage in FastAPI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#declaring-yml-file-with-permissions-roles" class="md-nav__link">
    Declaring YML file with permissions, roles.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parsing-yml-file-to-readonly-pickle-using-respo-cli-interface" class="md-nav__link">
    Parsing YML file to readonly pickle using respo CLI interface.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-in-fastapi-and-sqlalchemy" class="md-nav__link">
    Usage in FastAPI and SQLAlchemy.
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/rafsaf/respo/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>Overview</h1>

<h2 id="introduction">Introduction</h2>
<p><em>respo</em> states for resource policy and is tiny, user friendly tool for building RBAC systems based on static <code>yml</code> file, mainly with FastAPI framework in mind. In most cases – for even large set of roles – single file would be enough to provide restricting system access.</p>
<p>Features:</p>
<ul>
<li>
<p>It provides custom fields for <strong>SQLAlchemy</strong> and <strong>Django</strong> to store users roles in database.</p>
</li>
<li>
<p>Implements R. Sandhu Role-based access control <a href="https://profsandhu.com/articles/advcom/adv_comp_rbac.pdf">text</a>.</p>
</li>
<li>
<p>Dead simple, fast and can be trusted – 100% coverage.</p>
</li>
<li>
<p><strong>No issues</strong> with mutlithreading and multiprocessing – you just pass around already prepared, compiled respo_model (from file) in your app that is <strong>readonly</strong>.</p>
</li>
<li>
<p>Generates your roles, permissions offline and compile it to pickle file for superfast access in an app.</p>
</li>
<li>
<p>Detailed documentation and error messages in CLI command.</p>
</li>
<li>
<p>100% autocompletion and typing support with optional code generation for even better typing support.</p>
</li>
</ul>
<hr />
<p><em>Note, every piece of code in the docs is a tested python/yml file, feel free to use it.</em></p>
<h2 id="usage-in-fastapi">Usage in FastAPI</h2>
<p>The goal is to use simple and reusable dependency factory <code>user_have_permission("some permission")</code> that will verify just having <code>User</code> database instance if user have access to resoruce. Single endpoint must have single permission for it, and thanks to respo compilation step, every "stronger" permissions and roles would include "weaker" so <strong>we don't need to have the if statements everywhere around application</strong>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">.dependencies</span> <span class="kn">import</span> <span class="n">user_have_permission</span>

<span class="o">...</span>


<span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/read_all/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">users_read_all</span><span class="p">(</span><span class="n">user</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">user_have_permission</span><span class="p">(</span><span class="s2">&quot;users.read_all&quot;</span><span class="p">))):</span>
    <span class="k">return</span> <span class="n">user</span>
</code></pre></div></td></tr></table></div>
<h2 id="declaring-yml-file-with-permissions-roles">Declaring YML file with permissions, roles.</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code># paste this file to &quot;respo-example.yml&quot;

permissions:
  - user.read_basic
  - user.read_all

principles:
  - when: user.read_all
    then: [user.read_basic]

roles:
  - name: default
    permissions:
      - user.read_basic

  - name: admin
    include: [default]
    permissions:
      - user.read_all
</code></pre></div></td></tr></table></div>
<p>There are 3 sections:</p>
<ul>
<li><strong>permissions</strong>, list of double labels <code>"{collection}.{label}"</code>, they represent single permission that user can be given.</li>
<li><strong>principles</strong>, list of principles where one can declare rules for permissions to contain others. For example, we want to some one that (through some role) have "more powerful" permission <code>user.read_all</code> to also have access to resources that require <code>user.read_basic</code> permission.</li>
<li><strong>roles</strong>, list of roles objects, note that they have unique <code>name</code>, set of <code>permissions</code> and optional list <code>include</code> of other roles, so we can give admin role the same set of rules as default user (and add more powerful ones).</li>
</ul>
<h2 id="parsing-yml-file-to-readonly-pickle-using-respo-cli-interface">Parsing YML file to readonly pickle using respo CLI interface.</h2>
<p>Thanks to <a href="https://click.palletsprojects.com/">Click</a>, <em>respo</em> has powerful cli interface.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gp">$ </span>respo --help  <span class="c1"># prints all available commands</span>

<span class="gp">$ </span>respo create respo-example.yml  <span class="c1"># create model from file</span>

<span class="gp">#</span><span class="c1">## Result ###</span>
<span class="gp">$ </span>INFO: Validating respo model from respo-example.yml...
<span class="gp">$ </span>INFO: Saved binary file to .respo_cache/__auto__respo_model.bin
<span class="gp">$ </span>INFO: Saved yml file to .respo_cache/__auto__respo_model.yml
<span class="gp">$ </span>INFO: Saved python file to respo_model.py
<span class="gp">$ </span>INFO: Processed <span class="k">in</span> <span class="m">0</span>.0058s. Bin file size: <span class="m">0</span>.0007 mb.
<span class="gp">$ </span>INFO: Success!
</code></pre></div></td></tr></table></div>
<p>That powerful command create serveral of things:</p>
<ul>
<li>
<p><code>.respo_cache/__auto__respo_model.bin</code> file (pickle format of model).</p>
</li>
<li>
<p><code>.respo_cache/__auto__respo_model.yml</code> file (yml format of model).</p>
</li>
<li>
<p><code>respo_model.py</code> file (python file of model for better autocompletion).</p>
</li>
</ul>
<p>(<em>Refer to User Guide for more information about first two of them.</em>)</p>
<p><strong>respo_model.py</strong></p>
<p>Autogenerated file with class based on respo.RespoModel with bonus autocompletion.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Auto generated using respo create command</span>
<span class="sd">Docs: https://rafsaf.github.io/respo/</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">import</span> <span class="nn">respo</span>


<span class="k">class</span> <span class="nc">RespoModel</span><span class="p">(</span><span class="n">respo</span><span class="o">.</span><span class="n">RespoModel</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>

        <span class="k">class</span> <span class="nc">_ROLES</span><span class="p">(</span><span class="n">respo</span><span class="o">.</span><span class="n">ROLESContainer</span><span class="p">):</span>
            <span class="n">ADMIN</span><span class="p">:</span> <span class="nb">str</span>
            <span class="n">DEFAULT</span><span class="p">:</span> <span class="nb">str</span>

        <span class="k">class</span> <span class="nc">_PERMS</span><span class="p">(</span><span class="n">respo</span><span class="o">.</span><span class="n">PERMSContainer</span><span class="p">):</span>
            <span class="n">USER__ALL</span><span class="p">:</span> <span class="nb">str</span>
            <span class="n">USER__READ_ALL</span><span class="p">:</span> <span class="nb">str</span>
            <span class="n">USER__READ_BASIC</span><span class="p">:</span> <span class="nb">str</span>

        <span class="n">PERMS</span><span class="p">:</span> <span class="n">_PERMS</span>
        <span class="n">ROLES</span><span class="p">:</span> <span class="n">_ROLES</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">get_respo_model</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="s2">&quot;RespoModel&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">respo</span><span class="o">.</span><span class="n">RespoModel</span><span class="o">.</span><span class="n">get_respo_model</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</code></pre></div></td></tr></table></div>
<h2 id="usage-in-fastapi-and-sqlalchemy">Usage in FastAPI and SQLAlchemy.</h2>
<p>To interact with stateless, readonly respo_model created above, respo provides abstraction called <code>RespoClient</code> that can be stored in database as a custom respo <code>SQLAlchemyRespoField</code> field, be given or removed a role that can also check using respo_model instance its permissions.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">AsyncSession</span><span class="p">,</span> <span class="n">create_async_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">registry</span>

<span class="kn">from</span> <span class="nn">respo</span> <span class="kn">import</span> <span class="n">RespoClient</span>
<span class="kn">from</span> <span class="nn">respo.fields.sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemyRespoField</span>

<span class="kn">from</span> <span class="nn">.respo_model</span> <span class="kn">import</span> <span class="n">RespoModel</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">registry</span><span class="p">()</span>


<span class="nd">@Base</span><span class="o">.</span><span class="n">mapped</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ExampleModel</span><span class="p">:</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;example_model&quot;</span>
    <span class="n">__sa_dataclass_metadata_key__</span> <span class="o">=</span> <span class="s2">&quot;sa&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sa&quot;</span><span class="p">:</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)})</span>
    <span class="n">respo_field</span><span class="p">:</span> <span class="n">RespoClient</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">RespoClient</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;sa&quot;</span><span class="p">:</span> <span class="n">Column</span><span class="p">(</span><span class="n">SQLAlchemyRespoField</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;Ursula&quot;</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sa&quot;</span><span class="p">:</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="s2">&quot;Ursula&quot;</span><span class="p">)},</span>
    <span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">respo_model</span> <span class="o">=</span> <span class="n">RespoModel</span><span class="o">.</span><span class="n">get_respo_model</span><span class="p">()</span>  <span class="c1"># loads respo model from pickled file</span>

    <span class="n">async_engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span>
        <span class="s2">&quot;sqlite+aiosqlite:///db.sqlite3&quot;</span><span class="p">,</span> <span class="n">pool_pre_ping</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">async_engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">conn</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncSession</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">new_obj</span> <span class="o">=</span> <span class="n">ExampleModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Respo&quot;</span><span class="p">)</span>
            <span class="n">new_obj</span><span class="o">.</span><span class="n">respo_field</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="n">respo_model</span><span class="o">.</span><span class="n">ROLES</span><span class="o">.</span><span class="n">ADMIN</span><span class="p">,</span> <span class="n">respo_model</span><span class="p">)</span>

            <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_obj</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># respo_field is stored as a string!</span>
            <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">new_obj</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">new_obj</span><span class="o">.</span><span class="n">respo_field</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span>
                <span class="n">respo_model</span><span class="o">.</span><span class="n">PERMS</span><span class="o">.</span><span class="n">USER__READ_BASIC</span><span class="p">,</span> <span class="n">respo_model</span>
            <span class="p">)</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p>Note, thanks to smart types in RespoField for SQLAlchemy and auto generated typed file <code>respo_model</code> we have powerful autocompletions:</p>
<p><img alt="autocompletion-respo-client" src="images/000_autocompletion_respo_client.jpg" /></p>
<p><img alt="autocompletion-respo-client" src="images/001_autocompletion_respo_client.jpg" /></p>
<p><img alt="autocompletion-respo-client" src="images/002_autocompletion_respo_client.jpg" /></p>
<p><br>
<br>
<br></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        
        <a href="install/" class="md-footer__link md-footer__link--next" aria-label="Next: Install" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Install
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>